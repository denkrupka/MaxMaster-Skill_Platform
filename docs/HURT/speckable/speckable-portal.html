<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Speckable.pl ‚Äî Portal B2B</title>
<style>
:root{--a:#1a3e6f;--a2:#2b5ea7;--a3:#e8f0fb;--s:#fff;--s2:#f5f7fa;--b:#dde3ec;--b2:#eaeef4;
--g:#5cb85c;--o:#e89c30;--r:#d9534f;--t:#333;--t2:#666;--t3:#999;--rr:8px;--sh:0 2px 12px rgba(26,62,111,.07)}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--s2);color:var(--t);font-size:14px}
a{color:var(--a2);text-decoration:none}
.hdr{background:linear-gradient(135deg,var(--a),var(--a2));color:#fff;padding:10px 16px;display:flex;align-items:center;gap:14px;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px rgba(0,0,0,.15);flex-wrap:wrap}
.hdr .logo{font-size:18px;font-weight:700;letter-spacing:.5px;white-space:nowrap}
.hdr .logo span{color:var(--o);font-weight:400}
.hdr .search{flex:1;min-width:200px;max-width:500px;display:flex;gap:6px}
.hdr .search input{flex:1;padding:7px 12px;border:none;border-radius:var(--rr);font-size:13px;outline:none}
.hdr .search button{padding:7px 16px;border:none;border-radius:var(--rr);background:var(--o);color:#fff;font-weight:600;cursor:pointer;font-size:13px}
.hdr .auth{margin-left:auto;display:flex;align-items:center;gap:8px;white-space:nowrap}
.btn-login{padding:6px 16px;border:2px solid #fff;border-radius:var(--rr);background:transparent;color:#fff;font-weight:600;cursor:pointer;font-size:12px;transition:.15s}
.btn-login:hover{background:rgba(255,255,255,.15)}
.btn-login:disabled{opacity:.5}
.btn-logout{padding:6px 12px;border:1px solid rgba(255,255,255,.3);border-radius:var(--rr);background:transparent;color:rgba(255,255,255,.7);cursor:pointer;font-size:11px}
.btn-logout:hover{color:#fff;border-color:#fff}
.auth-st{font-size:11px}.auth-st.ok{color:#9f9}.auth-st.err{color:#f99}.auth-st.busy{color:#ff9}
.bc{background:var(--s);padding:8px 16px;border-bottom:1px solid var(--b);display:flex;flex-wrap:wrap;gap:4px;font-size:12px;color:var(--t2)}
.bc a{color:var(--a2)}.bc span{color:var(--t3)}
.main{max-width:1300px;margin:0 auto;padding:12px 16px}
.grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fill,minmax(170px,1fr))}
.grid.products{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}
.card{background:var(--s);border:1px solid var(--b);border-radius:var(--rr);overflow:hidden;cursor:pointer;transition:.15s;display:flex;flex-direction:column}
.card:hover{border-color:var(--a2);box-shadow:var(--sh)}
.card-img{height:110px;background:var(--s2);display:flex;align-items:center;justify-content:center;overflow:hidden;border-bottom:1px solid var(--b2)}
.card-img img{max-width:90%;max-height:100%;object-fit:contain}
.card-img .no-img{font-size:28px;opacity:.2}
.card-body{padding:8px 10px;flex:1;display:flex;flex-direction:column}
.card-name{font-size:12px;font-weight:600;line-height:1.35;margin-bottom:4px;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.card-sku{font-size:10px;color:var(--t3);margin-bottom:4px}
.card-price{font-size:13px;font-weight:700;color:var(--a);margin-top:auto}
.card-stock{font-size:10px;margin-top:3px}
.card-stock.in{color:var(--g)}.card-stock.out{color:var(--r)}
.prod{background:var(--s);border-radius:var(--rr);padding:16px;box-shadow:var(--sh)}
.prod-top{display:grid;grid-template-columns:1fr 1fr;gap:20px}
@media(max-width:768px){.prod-top{grid-template-columns:1fr}}
.gallery{display:flex;flex-direction:column;gap:8px}
.gallery .main-img{width:100%;max-height:380px;object-fit:contain;border-radius:var(--rr);border:1px solid var(--b);background:var(--s2)}
.thumbs{display:flex;gap:6px;overflow-x:auto}
.thumbs img{width:60px;height:60px;object-fit:contain;border:2px solid var(--b);border-radius:4px;cursor:pointer;background:var(--s2)}
.thumbs img:hover,.thumbs img.active{border-color:var(--a2)}
.prod-info h1{font-size:20px;margin-bottom:10px;color:var(--a)}
.prod-meta{font-size:12px;color:var(--t2);margin-bottom:12px;display:flex;flex-wrap:wrap;gap:8px 16px}
.prod-meta b{color:var(--t)}
.prod-prices{background:var(--a3);padding:12px;border-radius:var(--rr);margin-bottom:12px}
.prod-prices .net{font-size:22px;font-weight:700;color:var(--a)}
.prod-prices .gross{font-size:13px;color:var(--t2)}
.prod-prices .unit{font-size:12px;color:var(--t3)}
.stock-row{display:flex;gap:16px;margin-bottom:12px}
.stock-badge{padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600}
.stock-badge.in{background:#e6f9e6;color:#2d7a2d}
.stock-badge.ext{background:#fff3e0;color:#b77d2a}
.stock-badge.out{background:#fde8e8;color:#a33}
.prod-desc{margin-top:16px;font-size:13px;line-height:1.6;color:var(--t2);max-height:300px;overflow-y:auto;border-top:1px solid var(--b);padding-top:12px}
.rel-title{font-size:16px;font-weight:700;margin:20px 0 10px;color:var(--a)}
.sec-title{font-size:18px;font-weight:700;margin-bottom:12px;color:var(--a)}
.sec-count{font-size:13px;color:var(--t3);font-weight:400}
.welcome{text-align:center;padding:80px 20px;max-width:500px;margin:0 auto}
.welcome h2{font-size:22px;color:var(--a);margin-bottom:12px}
.welcome p{color:var(--t2);margin-bottom:24px;line-height:1.5}
.btn-big{padding:12px 32px;border:none;border-radius:var(--rr);background:var(--a2);color:#fff;font-size:15px;font-weight:600;cursor:pointer;transition:.15s}
.btn-big:hover{background:var(--a)}
.loading{text-align:center;padding:60px;color:var(--t3);font-size:14px}
.loading::after{content:'';display:block;width:28px;height:28px;border:3px solid var(--b);border-top-color:var(--a2);border-radius:50%;animation:spin .7s linear infinite;margin:12px auto 0}
@keyframes spin{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:60px;color:var(--t3)}
</style>
</head>
<body>

<div class="hdr">
  <div class="logo">Speckable<span>.pl</span></div>
  <div class="search">
    <input id="q" placeholder="Szukaj produktu..." onkeydown="if(event.key==='Enter')doSearch()">
    <button onclick="doSearch()">üîç</button>
  </div>
  <div class="auth">
    <span class="auth-st" id="st">üîí</span>
    <button class="btn-login" id="btnLogin" onclick="doLogin()">üîë Zaloguj</button>
    <button class="btn-logout" id="btnLogout" onclick="doLogout()" style="display:none">Wyloguj</button>
  </div>
</div>
<div class="bc" id="bc"><a href="#" onclick="go('/pl/list');return false">üè† Katalog</a></div>
<div class="main" id="app">
  <div class="welcome">
    <h2>Speckable.pl ‚Äî Portal B2B</h2>
    <p>Hurtownia materia≈Ç√≥w elektroinstalacyjnych.<br>Kliknij poni≈ºej, aby zalogowaƒá siƒô i przeglƒÖdaƒá katalog z cenami B2B.</p>
    <button class="btn-big" onclick="doLogin()">üîë Zaloguj siƒô do katalogu</button>
  </div>
</div>

<script>
function esc(s){const d=document.createElement('div');d.textContent=s||'';return d.innerHTML}
function imgP(u){return u?'/api/img?url='+encodeURIComponent(u):''}

let logged=false;

function setAuth(ok,msg){
  logged=ok;
  const s=document.getElementById('st'),bl=document.getElementById('btnLogin'),bo=document.getElementById('btnLogout');
  if(ok){s.textContent='‚úÖ zalogowano';s.className='auth-st ok';bl.style.display='none';bo.style.display=''}
  else{s.textContent=msg||'üîí niezalogowano';s.className='auth-st err';bl.style.display='';bo.style.display='none'}
}

async function doLogin(){
  const s=document.getElementById('st'),bl=document.getElementById('btnLogin');
  s.textContent='‚è≥ logowanie...';s.className='auth-st busy';bl.disabled=true;
  try{
    const r=await fetch('/api/login');const j=await r.json();
    if(j.loggedIn){setAuth(true);go('/pl/list')}else setAuth(false,'‚ùå b≈ÇƒÖd logowania')
  }catch(e){setAuth(false,'‚ùå serwer nieosiƒÖgalny')}
  bl.disabled=false;
}

async function doLogout(){
  try{await fetch('/api/logout')}catch{}
  setAuth(false);
  document.getElementById('app').innerHTML='<div class="welcome"><h2>Wylogowano</h2><p>Sesja zamkniƒôta.</p><button class="btn-big" onclick="doLogin()">üîë Zaloguj ponownie</button></div>';
}

function go(path){window.scrollTo(0,0);loadPage(path)}

async function loadPage(path){
  const app=document.getElementById('app');
  app.innerHTML='<div class="loading">≈Åadowanie...</div>';
  try{
    const r=await fetch('/api/page?path='+encodeURIComponent(path));const j=await r.json();
    if(r.status===401){setAuth(false);app.innerHTML='<div class="welcome"><h2>Wymagane logowanie</h2><p>'+esc(j.error||'')+'</p><button class="btn-big" onclick="doLogin()">üîë Zaloguj siƒô</button></div>';return}
    if(j.error){app.innerHTML='<div class="empty">‚ùå '+esc(j.error)+'</div>';return}
    if(j.type==='product')renderProduct(j.data);else renderList(j.data)
  }catch(e){app.innerHTML='<div class="empty">‚ùå '+esc(e.message)+'</div>'}
}

async function doSearch(){
  const q=document.getElementById('q').value.trim();if(!q)return;
  const app=document.getElementById('app');app.innerHTML='<div class="loading">Szukam: '+esc(q)+'...</div>';
  try{
    const r=await fetch('/api/search?q='+encodeURIComponent(q));const j=await r.json();
    if(r.status===401){setAuth(false);return go('/pl/list')}
    if(j.type==='product')renderProduct(j.data);else renderList(j.data,'Wyniki: "'+q+'"')
  }catch(e){app.innerHTML='<div class="empty">‚ùå '+esc(e.message)+'</div>'}
}

function renderList(data,overTitle){
  const app=document.getElementById('app');renderBC(data.breadcrumb||[]);
  if(!data.items||!data.items.length){app.innerHTML='<div class="empty">Brak wynik√≥w</div>';return}
  const t=overTitle||data.title||'Katalog';
  let h='<div class="sec-title">'+esc(t)+' <span class="sec-count">('+data.items.length+')</span></div>';
  h+='<div class="grid'+(data.hasProducts?' products':'')+'">';
  for(const i of data.items){
    const im=i.image?'<img src="'+imgP(i.image)+'" loading="lazy" onerror="this.style.display=\'none\';this.nextElementSibling.style.display=\'flex\'"><div class="no-img" style="display:none">üì¶</div>':'<div class="no-img">üìÅ</div>';
    h+='<div class="card" onclick="go(\''+esc(i.slug)+'\')">';
    h+='<div class="card-img">'+im+'</div><div class="card-body">';
    h+='<div class="card-name">'+esc(i.name)+'</div>';
    if(i.symbol)h+='<div class="card-sku">SKU: '+esc(i.symbol)+'</div>';
    if(i.price)h+='<div class="card-price">'+esc(i.price)+'</div>';
    if(i.stock){const c=parseInt(i.stock)>0?'in':'out';h+='<div class="card-stock '+c+'">‚óè '+esc(i.stock)+' szt</div>'}
    h+='</div></div>'
  }
  h+='</div>';app.innerHTML=h
}

function renderProduct(p){
  const app=document.getElementById('app');renderBC(p.breadcrumb||[]);
  let h='<div class="prod"><div class="prod-top"><div class="gallery">';
  if(p.images&&p.images.length){
    h+='<img class="main-img" id="mi" src="'+imgP(p.images[0])+'">';
    if(p.images.length>1){h+='<div class="thumbs">';for(let i=0;i<p.images.length;i++)h+='<img src="'+imgP(p.images[i])+'" onclick="document.getElementById(\'mi\').src=this.src;document.querySelectorAll(\'.thumbs img\').forEach(t=>t.classList.remove(\'active\'));this.classList.add(\'active\')" class="'+(i===0?'active':'')+'">';h+='</div>'}
  }else h+='<div style="height:200px;display:flex;align-items:center;justify-content:center;font-size:48px;opacity:.15;background:var(--s2);border-radius:var(--rr)">üì¶</div>';
  h+='</div><div class="prod-info"><h1>'+esc(p.title)+'</h1><div class="prod-meta">';
  if(p.sku)h+='<div>SKU: <b>'+esc(p.sku)+'</b></div>';
  if(p.ean)h+='<div>EAN: <b>'+esc(p.ean)+'</b></div>';
  if(p.brand)h+='<div>Producent: <b>'+esc(p.brand)+'</b></div>';
  if(p.unit)h+='<div>Jednostka: <b>'+esc(p.unit)+'</b></div>';
  h+='</div><div class="prod-prices">';
  if(p.priceNetto!=null)h+='<div class="net">'+p.priceNetto.toFixed(2).replace('.',',')+' '+(p.currency||'PLN')+' <small>netto</small></div>';
  if(p.priceGross!=null)h+='<div class="gross">'+p.priceGross.toFixed(2).replace('.',',')+' '+(p.currency||'PLN')+' brutto</div>';
  if(p.unit)h+='<div class="unit">za 1 '+esc(p.unit)+'</div>';
  h+='</div>';
  if(p.stock||p.stockExternal){h+='<div class="stock-row">';if(p.stock){const n=parseInt(p.stock);h+='<div class="stock-badge '+(n>0?'in':'out')+'">Magazyn: '+esc(p.stock)+' '+esc(p.unit||'szt')+'</div>'}if(p.stockExternal)h+='<div class="stock-badge ext">Zewnƒôtrzny: '+esc(p.stockExternal)+' '+esc(p.unit||'szt')+'</div>';h+='</div>'}
  h+='</div></div>';
  if(p.description)h+='<div class="prod-desc"><b>Opis:</b><br>'+esc(p.description)+'</div>';
  h+='</div>';
  if(p.related&&p.related.length){
    h+='<div class="rel-title">PowiƒÖzane produkty</div><div class="grid products">';
    for(const r of p.related){const ri=r.image?'<img src="'+imgP(r.image)+'" loading="lazy" onerror="this.style.display=\'none\'">':'<div class="no-img">üì¶</div>';h+='<div class="card" onclick="go(\''+esc(r.slug)+'\')"><div class="card-img">'+ri+'</div><div class="card-body"><div class="card-name">'+esc(r.name)+'</div>';if(r.price)h+='<div class="card-price">'+esc(r.price)+'</div>';h+='</div></div>'}
    h+='</div>'
  }
  app.innerHTML=h
}

function renderBC(items){
  const bc=document.getElementById('bc');
  let h='<a href="#" onclick="go(\'/pl/list\');return false">üè† Katalog</a>';
  for(const i of items){
    if(!i.name||i.name==='Speckable'||i.name==='Strona g≈Ç√≥wna')continue;
    h+=' <span>‚Ä∫</span> ';
    h+=i.slug&&i.slug.startsWith('/pl/list')?'<a href="#" onclick="go(\''+esc(i.slug)+'\');return false">'+esc(i.name)+'</a>':'<span>'+esc(i.name)+'</span>'
  }
  bc.innerHTML=h
}

// Init: just check status, never auto-login
(async()=>{
  try{const r=await fetch('/api/status');const j=await r.json();if(j.loggedIn){setAuth(true);go('/pl/list')}else setAuth(false)}
  catch(e){setAuth(false,'‚ùå serwer niedostƒôpny')}
})();
</script>
</body>
</html>
